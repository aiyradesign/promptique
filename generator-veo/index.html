<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Prompt Generator â€“ Video Veo3 | prompt.ique</title>
    <meta name="description" content="Buat prompt AI untuk video sinematik Veo3 dengan gaya visual ultra realistis atau kreatif melalui Promptique.">
    
    <meta property="og:title" content="Promptique | AI Prompt Generator Video Veo3">
    <meta property="og:description" content="Buat prompt AI untuk video Veo3 berkualitas tinggi. Cepat dan siap digunakan di Gemini dan AI Studio.">
    <meta property="og:image" content="https://promptique.my.id/generator-veo/video_poster.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:url" content="https://promptique.my.id/generator-veo">
    <meta property="og:type" content="website">
    
    <link rel="icon" href="../icon.png" type="image/png" />

    <!-- Tailwind CSS & Font Awesome -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }
        .gradient-text {
            background: linear-gradient(to right, #5eead4, #a78bfa, #f472b6);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; text-fill-color: transparent;
        }
        .form-section {
            border-radius: 0.75rem; /* rounded-xl */
            padding: 1.5rem; /* p-6 */
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
            border-width: 1px; /* Ensure border is always present */
        }
        @media (min-width: 640px) { .form-section { padding: 2rem; } }
        .form-label {
            display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .form-label .fa-solid { width: 16px; text-align: center; }
        .form-input, .form-textarea, .form-select {
            width: 100%; border-radius: 0.5rem; padding: 0.75rem 1rem; transition: all 0.2s;
            border-width: 1px;
        }
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            border-color: #c084fc; /* A brighter purple/pink */
            box-shadow: 0 0 0 3px rgba(192, 132, 252, 0.4);
            outline: none;
        }
        .form-input:disabled {
            cursor: not-allowed;
        }
        .form-select {
            background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em;
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
        }
        .loading-spinner {
            border: 3px solid rgba(255, 255, 255, 0.2); width: 20px; height: 20px;
            border-radius: 50%; border-left-color: white;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .modal-overlay { transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease; }
        
        fieldset:disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        
        /* Light Theme */
        body.light-theme { background-color: #f8fafc; color: #1e293b; }
        body.light-theme .form-section, body.light-theme .modal-content, body.light-theme .custom-alert-box { background-color: #ffffff; border-color: #e2e8f0; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05); }
        body.light-theme .form-section { border-color: #cbd5e1; } /* More visible border */
        body.light-theme .form-label { color: #334155; }
        body.light-theme .form-label .fa-solid { color: #64748b; }
        body.light-theme .form-input, body.light-theme .form-textarea, body.light-theme .form-select { background-color: #f8fafc; border-color: #9ca3af; color: #1e293b; } /* More visible border */
        body.light-theme .form-input:disabled { background-color: #e2e8f0; }
        body.light-theme .form-input::placeholder, body.light-theme .form-textarea::placeholder { color: #94a3b8; }
        body.light-theme .form-input:focus, body.light-theme .form-textarea:focus, body.light-theme .form-select:focus { border-color: #a78bfa; box-shadow: 0 0 0 2px rgba(167, 139, 250, 0.3); outline: none;}
        body.light-theme .text-slate-100 { color: #0f172a; }
        body.light-theme .text-slate-200 { color: #1e293b; }
        body.light-theme .text-slate-300 { color: #334155; }
        body.light-theme .text-slate-400 { color: #475569; }
        body.light-theme .border-slate-700 { border-color: #e2e8f0; }
        body.light-theme .floating-btn { background-color: white; color: #1e293b; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        body.light-theme .form-select { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2364748b' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); }
        body.light-theme .btn-secondary-theme { background-color: #e2e8f0; color: #334155; }
        body.light-theme .btn-secondary-theme:hover { background-color: #cbd5e1; }

        /* Dark Theme */
        body.dark-theme { background-color: #0f172a; color: #e2e8f0; }
        body.dark-theme .form-section, body.dark-theme .modal-content, body.dark-theme .custom-alert-box { background-color: #1e293b; border-color: #475569; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        body.dark-theme .form-label { color: #94a3b8; }
        body.dark-theme .form-label .fa-solid { color: #64748b; }
        body.dark-theme .form-input, body.dark-theme .form-textarea, body.dark-theme .form-select { background-color: #1e293b; border-color: #64748b; color: #f1f5f9; } /* More visible border */
        body.dark-theme .form-input:disabled { background-color: #334155; opacity: 0.7; }
        body.dark-theme .form-input::placeholder, body.dark-theme .form-textarea::placeholder { color: #64748b; }
        body.dark-theme .form-input:focus, body.dark-theme .form-textarea:focus, body.dark-theme .form-select:focus { border-color: #a78bfa; box-shadow: 0 0 0 2px rgba(167, 139, 250, 0.3); outline: none;}
        body.dark-theme .text-slate-100 { color: #f8fafc; }
        body.dark-theme .text-slate-300 { color: #cbd5e1; }
        body.dark-theme .text-slate-400 { color: #94a3b8; }
        body.dark-theme .floating-btn { background-color: #334155; color: #cbd5e1; }
        body.dark-theme .form-select { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%2394a3b8' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e"); }
        body.dark-theme .btn-secondary-theme { background-color: #475569; color: #f1f5f9; }
        body.dark-theme .btn-secondary-theme:hover { background-color: #64748b; }
        
        /* Custom Alert */
        .custom-alert-overlay { position: fixed; inset: 0; background-color: rgba(15, 23, 42, 0.6); backdrop-filter: blur(5px); display: flex; align-items: center; justify-content: center; padding: 1rem; z-index: 110; }
        .custom-alert-box { width: 100%; max-width: 400px; padding: 2rem; text-align: center; box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1); }
        .custom-alert-icon { width: 4rem; height: 4rem; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin-bottom: 1rem; font-size: 2rem; }
        .custom-alert-icon.success { background-color: rgba(45, 212, 191, 0.1); color: #5eead4; }
        .custom-alert-icon.error { background-color: rgba(244, 63, 94, 0.1); color: #fb7185; }
    </style>
</head>
<body class="antialiased">

    <!-- Floating Buttons -->
    <div class="fixed top-4 right-4 z-50 flex flex-col gap-3">
        <button id="theme-toggle" class="floating-btn h-12 w-12 flex items-center justify-center rounded-full border border-slate-700 shadow-lg" title="Ganti Tema">
            <i class="fas fa-sun"></i>
        </button>
        <button id="history-btn" class="floating-btn h-12 w-12 flex items-center justify-center rounded-full border border-slate-700 shadow-lg" title="Riwayat Cerita">
            <i class="fas fa-history"></i>
        </button>
    </div>
    
    <!-- API Guide Modal -->
    <div id="guide-modal" class="modal-overlay fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm hidden">
        <div class="modal-content max-w-lg w-full rounded-xl">
            <div class="flex items-center justify-between p-5 border-b border-slate-700">
                <h3 class="text-xl font-bold text-slate-100 flex items-center gap-3"><i class="fas fa-key gradient-text"></i>Panduan Mendapatkan API Key</h3>
                <button class="close-modal-btn text-slate-400 hover:text-white transition-colors"><i class="fa-solid fa-xmark fa-lg"></i></button>
            </div>
            <div class="p-6 space-y-6 max-h-[70vh] overflow-y-auto">
                <!-- Desktop Guide -->
                <div class="hidden md:block text-slate-300 space-y-6">
                    <div class="flex items-start gap-4"><div class="text-violet-400 text-2xl w-8 text-center pt-1"><i class="fas fa-desktop"></i></div><div><h3 class="font-bold text-lg text-slate-100">Langkah 1: Buka AI Studio & Dapatkan Kunci</h3><p class="text-slate-400">Di komputer Anda, buka <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-teal-300 hover:underline font-semibold">Google AI Studio</a>. Pada menu di sebelah kiri, klik <strong class="text-white">"Get API key"</strong>.</p></div></div>
                    <div class="flex items-start gap-4"><div class="text-violet-400 text-2xl w-8 text-center pt-1"><i class="fas fa-plus-square"></i></div><div><h3 class="font-bold text-lg text-slate-100">Langkah 2: Buat Kunci di Proyek Baru</h3><p class="text-slate-400">Anda akan diarahkan ke halaman Google AI for Developers. Klik tombol <strong class="text-white">"Create API key in new project"</strong>.</p></div></div>
                    <div class="flex items-start gap-4"><div class="text-violet-400 text-2xl w-8 text-center pt-1"><i class="fas fa-copy"></i></div><div><h3 class="font-bold text-lg text-slate-100">Langkah 3: Salin Kunci Anda</h3><p class="text-slate-400">Sebuah jendela akan muncul menampilkan Kunci API baru Anda. Klik ikon salin <i class="fas fa-copy"></i> di sebelahnya untuk menyimpannya ke clipboard.</p></div></div>
                    <div class="flex items-start gap-4"><div class="text-violet-400 text-2xl w-8 text-center pt-1"><i class="fas fa-paste"></i></div><div><h3 class="font-bold text-lg text-slate-100">Langkah 4: Tempel & Simpan di Aplikasi</h3><p class="text-slate-400">Kembali ke aplikasi ini, tempelkan kunci yang sudah disalin ke dalam kolom yang tersedia dan klik tombol <strong class="text-white">"Simpan"</strong>.</p></div></div>
                </div>
                <!-- Mobile Guide -->
                <div class="block md:hidden text-slate-300 space-y-6">
                     <div class="flex items-start gap-4"><div class="text-violet-400 text-2xl w-8 text-center pt-1"><i class="fas fa-mobile-alt"></i></div><div><h3 class="font-bold text-lg text-slate-100">Langkah 1: Buka Menu</h3><p class="text-slate-400">Di ponsel Anda, buka <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-teal-300 hover:underline font-semibold">Google AI Studio</a>. Ketuk ikon menu <i class="fas fa-bars"></i> di pojok kiri atas.</p></div></div>
                    <div class="flex items-start gap-4"><div class="text-violet-400 text-2xl w-8 text-center pt-1"><i class="fas fa-key"></i></div><div><h3 class="font-bold text-lg text-slate-100">Langkah 2: Pilih "Get API key"</h3><p class="text-slate-400">Dari menu yang muncul, ketuk pada pilihan <strong class="text-white">"Get API key"</strong>.</p></div></div>
                    <div class="flex items-start gap-4"><div class="text-violet-400 text-2xl w-8 text-center pt-1"><i class="fas fa-plus-square"></i></div><div><h3 class="font-bold text-lg text-slate-100">Langkah 3: Buat Kunci Baru</h3><p class="text-slate-400">Di halaman berikutnya, ketuk tombol <strong class="text-white">"Create API key in new project"</strong>.</p></div></div>
                    <div class="flex items-start gap-4"><div class="text-violet-400 text-2xl w-8 text-center pt-1"><i class="fas fa-copy"></i></div><div><h3 class="font-bold text-lg text-slate-100">Langkah 4: Salin Kunci Anda</h3><p class="text-slate-400">Kunci API baru Anda akan ditampilkan. Ketuk ikon salin <i class="fas fa-copy"></i> di sebelahnya.</p></div></div>
                    <div class="flex items-start gap-4"><div class="text-violet-400 text-2xl w-8 text-center pt-1"><i class="fas fa-paste"></i></div><div><h3 class="font-bold text-lg text-slate-100">Langkah 5: Tempel & Simpan</h3><p class="text-slate-400">Kembali ke aplikasi ini, tempelkan kunci Anda di kolom yang tersedia dan klik tombol <strong class="text-white">"Simpan"</strong>.</p></div></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- History Modal -->
    <div id="history-modal" class="modal-overlay fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm hidden">
        <div class="modal-content max-w-lg w-full rounded-xl">
            <div class="flex items-center justify-between p-5 border-b border-slate-700">
                <h3 class="text-xl font-bold text-slate-100 flex items-center gap-3"><i class="fas fa-history gradient-text"></i>Riwayat Cerita</h3>
                <button class="close-modal-btn text-slate-400 hover:text-white transition-colors"><i class="fa-solid fa-xmark fa-lg"></i></button>
            </div>
            <div id="history-list" class="p-6 space-y-3 max-h-[60vh] overflow-y-auto">
                <!-- History items will be populated here -->
            </div>
            <div class="p-5 border-t border-slate-700">
                <button id="clear-history-btn" class="w-full bg-red-600 hover:bg-red-500 text-white font-semibold py-2 px-4 rounded-lg flex items-center justify-center gap-2">
                    <i class="fas fa-trash-alt"></i> Hapus Semua Riwayat
                </button>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="modal-overlay fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm hidden">
        <div class="modal-content max-w-sm w-full rounded-xl">
            <div class="p-6 text-center">
                <i class="fas fa-exclamation-triangle text-4xl text-amber-400 mb-4"></i>
                <h3 class="text-lg font-bold text-slate-100">Konfirmasi Hapus</h3>
                <p class="text-sm text-slate-400 mt-2 mb-6">Apakah Anda yakin ingin menghapus API Key yang tersimpan?</p>
                <div class="flex justify-center gap-4">
                    <button id="cancel-delete-btn" class="btn-secondary-theme px-6 py-2 rounded-lg font-semibold">Batal</button>
                    <button id="confirm-delete-btn" class="bg-red-600 hover:bg-red-500 text-white px-6 py-2 rounded-lg font-semibold">Ya, Hapus</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Logout Confirmation Modal -->
    <div id="logout-confirm-modal" class="modal-overlay fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm hidden">
        <div class="modal-content max-w-sm w-full rounded-xl">
            <div class="p-6 text-center">
                <i class="fas fa-sign-out-alt text-4xl text-amber-400 mb-4"></i>
                <h3 class="text-lg font-bold text-slate-100">Konfirmasi Keluar</h3>
                <p class="text-sm text-slate-400 mt-2 mb-6">Apakah Anda yakin ingin keluar dan mengunci aplikasi?</p>
                <div class="flex justify-center gap-4">
                    <button id="cancel-logout-btn" class="btn-secondary-theme px-6 py-2 rounded-lg font-semibold">Batal</button>
                    <button id="confirm-logout-btn" class="bg-red-600 hover:bg-red-500 text-white px-6 py-2 rounded-lg font-semibold">Ya, Keluar</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Main Content -->
    <div class="container mx-auto max-w-4xl px-4 py-8 sm:py-12">
        <header class="text-center mb-10">
            <h1 class="text-4xl sm:text-5xl font-extrabold tracking-tight gradient-text">
                PROMPT GENERATOR VEO
            </h1>
             <p class="text-lg text-slate-400 mt-3">
                BY AIYRA DESIGN | PROMPT.IQUE
            </p>
        </header>

        <main class="space-y-8">
            <!-- Auth Section -->
            <section id="auth-section" class="form-section">
                <div id="login-form">
                    <h3 class="text-xl font-bold text-center gradient-text mb-4">Akses Diperlukan</h3>
                    <div class="max-w-sm mx-auto">
                        <label for="password-input" class="form-label justify-center">Kata Sandi</label>
                        <div class="relative flex items-center">
                            <input type="password" id="password-input" class="form-input w-full pr-10" placeholder="Masukkan sandi...">
                            <button type="button" id="toggle-password-btn" class="absolute inset-y-0 right-0 px-3 flex items-center text-slate-400 hover:text-slate-200">
                                <i class="fas fa-eye" id="password-eye-icon"></i>
                            </button>
                        </div>
                        <button id="login-btn" class="mt-4 w-full bg-violet-600 hover:bg-violet-500 text-white font-bold py-2 px-6 rounded-lg transition-colors">Masuk</button>
                    </div>
                </div>
                <div id="logout-area" class="hidden">
                    <div class="flex flex-col sm:flex-row justify-between items-center gap-3">
                        <p class="text-lg font-semibold text-teal-400">Selamat datang!</p>
                        <button id="logout-btn" class="w-full sm:w-auto px-4 py-2 bg-red-600 hover:bg-red-500 text-white font-semibold rounded-lg flex items-center justify-center">
                            <i class="fas fa-sign-out-alt mr-2"></i>Keluar
                        </button>
                    </div>
                </div>
            </section>
            
            <fieldset id="generator-fieldset" disabled class="space-y-8">
                <!-- API & Initial Concept Section -->
                <section class="form-section">
                    <h2 class="text-xl font-bold mb-6 text-center gradient-text"><i class="fas fa-key mr-2"></i>Langkah 1: Konsep & Pengaturan AI</h2>
                    <div class="mb-6 pb-6 border-b border-slate-700">
                        <label for="api-key-input" class="form-label"><i class="fa-solid fa-lock"></i>API Key Google AI</label>
                        <div class="flex flex-wrap gap-2 mb-3">
                            <button type="button" id="guide-btn" class="btn-secondary-theme flex-grow sm:flex-grow-0 px-4 py-2 font-semibold rounded-lg flex items-center justify-center flex-shrink-0"><i class="fas fa-book mr-2"></i>Panduan</button>
                            <a href="https://aistudio.google.com/app/apikey" target="_blank" rel="noopener noreferrer" class="btn-secondary-theme flex-grow sm:flex-grow-0 px-4 py-2 font-semibold rounded-lg flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-external-link-alt mr-2"></i>Dapatkan Key
                            </a>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-2">
                            <input type="password" id="api-key-input" class="form-input flex-grow" placeholder="Masukkan API Key Anda...">
                            <div class="flex gap-2 w-full sm:w-auto flex-shrink-0">
                                <button type="button" id="delete-api-key-button" class="flex-1 sm:w-auto justify-center px-4 py-2 bg-red-600 hover:bg-red-500 text-white font-semibold rounded-lg flex items-center"><i class="fas fa-trash-alt mr-2"></i>Hapus</button>
                                <button type="button" id="save-api-key-button" class="flex-1 sm:w-auto justify-center px-4 py-2 bg-violet-600 hover:bg-violet-500 text-white font-semibold rounded-lg flex items-center"><i class="fas fa-save mr-2"></i>Simpan</button>
                            </div>
                        </div>
                        <div id="api-status-indicator" class="mt-3 flex items-center gap-2 text-sm">
                            <span id="api-status-dot" class="w-3 h-3 rounded-full"></span>
                            <span id="api-status-text"></span>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <!-- Story Writing Guide -->
                        <div class="p-4 border border-slate-700 rounded-lg bg-slate-800/50">
                            <h4 class="font-semibold text-slate-200 mb-2 flex items-center gap-2"><i class="fas fa-info-circle text-violet-400"></i>Panduan Menulis Cerita</h4>
                            <ul class="list-disc list-inside text-slate-400 text-sm space-y-1">
                                <li><strong>Sebutkan Subjek:</strong> Siapa atau apa tokoh utamanya? (contoh: "seorang ksatria tua", "robot pengantar barang")</li>
                                <li><strong>Jelaskan Aksi:</strong> Apa yang sedang terjadi? (contoh: "berjalan di tengah hujan badai", "terbang melintasi kota")</li>
                                <li><strong>Gambarkan Latar:</strong> Di mana adegan ini berlangsung? (contoh: "di hutan ajaib saat fajar", "di stasiun luar angkasa")</li>
                            </ul>
                        </div>
                        <div>
                            <label for="video-story" class="form-label"><i class="fas fa-feather-alt"></i>Ceritakan singkat ide video Anda</label>
                            <textarea id="video-story" class="form-textarea" rows="4" placeholder="Contoh: Seorang ksatria tua berjalan sendirian di tengah hujan badai di sebuah hutan ajaib saat fajar..."></textarea>
                        </div>
                        <div>
                            <label for="style" class="form-label"><i class="fa-solid fa-palette"></i>Pilih Gaya Visual</label>
                            <select id="style" class="form-select"></select>
                        </div>
                        <button type="button" id="ai-generate-btn" class="w-full inline-flex items-center justify-center px-8 py-3 font-bold text-white rounded-full transition-all duration-300 bg-gradient-to-r from-teal-500 via-purple-500 to-pink-500 hover:shadow-lg hover:shadow-purple-500/20">
                           <span id="ai-btn-text"><i class="fas fa-lightbulb mr-3"></i>Kembangkan Ide dengan AI</span>
                           <div class="loading-spinner ml-3 hidden"></div>
                        </button>
                    </div>
                </section>

                <!-- Detailed Form Section (Initially Hidden) -->
                <form id="detailed-form" class="space-y-8 hidden">
                    <section class="form-section">
                        <h2 class="text-xl font-bold mb-6 text-center gradient-text"><i class="fas fa-pencil-alt mr-2"></i>Langkah 2: Sesuaikan Hasil AI</h2>
                        <div class="space-y-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div><label for="subject" class="form-label"><i class="fa-solid fa-user-astronaut"></i>Subjek Utama</label><input type="text" id="subject" class="form-input" placeholder="Diisi oleh AI..."></div>
                                <div><label for="action" class="form-label"><i class="fa-solid fa-person-running"></i>Aksi / Kegiatan</label><input type="text" id="action" class="form-input" placeholder="Diisi oleh AI..."></div>
                            </div>
                            <div><label for="setting" class="form-label"><i class="fa-solid fa-mountain-sun"></i>Latar / Lingkungan</label><input type="text" id="setting" class="form-input" placeholder="Diisi oleh AI..."></div>
                            <div><label for="lighting" class="form-label"><i class="fa-solid fa-sun"></i>Pencahayaan</label><select id="lighting" class="form-select"></select></div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div><label for="camera-angle" class="form-label"><i class="fa-solid fa-camera-retro"></i>Sudut Kamera</label><select id="camera-angle" class="form-select"></select></div>
                                <div><label for="camera-shot" class="form-label"><i class="fa-solid fa-expand"></i>Jenis Bidikan</label><select id="camera-shot" class="form-select"></select></div>
                                <div><label for="camera-movement" class="form-label"><i class="fa-solid fa-video"></i>Gerakan Kamera</label><select id="camera-movement" class="form-select"></select></div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div><label for="duration" class="form-label"><i class="fa-solid fa-clock"></i>Durasi</label><input type="text" id="duration" class="form-input" value="8 Detik" disabled></div>
                                <div><label for="extra-details" class="form-label"><i class="fa-solid fa-wand-magic-sparkles"></i>Detail Tambahan & Efek</label><input type="text" id="extra-details" class="form-input" placeholder="Diisi oleh AI..."></div>
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div><label for="sound-effects" class="form-label"><i class="fa-solid fa-volume-high"></i>Efek Suara Latar</label><textarea id="sound-effects" class="form-textarea" rows="2" placeholder="Diisi oleh AI..."></textarea></div>
                                <div><label for="character-speech" class="form-label"><i class="fa-solid fa-comments"></i>Ucapan Karakter</label><textarea id="character-speech" class="form-textarea" rows="2" placeholder="Diisi oleh AI..."></textarea></div>
                            </div>
                            <div><label for="negative-prompt" class="form-label"><i class="fa-solid fa-ban"></i>Prompt Negatif (Opsional)</label><input type="text" id="negative-prompt" class="form-input" placeholder="Diisi oleh AI..."></div>
                        </div>
                    </section>
                    
                    <!-- Action Buttons -->
                    <section class="flex flex-col sm:flex-row gap-4">
                        <button type="reset" class="btn-secondary-theme w-full sm:w-auto px-6 py-3 font-bold rounded-lg transition-colors"><i class="fas fa-rotate-left mr-2"></i>Reset</button>
                        <button type="submit" class="w-full sm:flex-grow bg-violet-600 hover:bg-violet-500 text-white font-bold py-3 px-8 rounded-lg transition-colors"><i class="fas fa-cogs mr-2"></i>Hasilkan Prompt Final</button>
                    </section>
                </form>
                
                <!-- Result Section -->
                <section id="result-section" class="mt-10 pt-6 border-t border-slate-700 hidden">
                    <!-- Veo Guide -->
                    <div class="mb-6 p-4 border border-slate-700 rounded-lg bg-slate-800/50">
                        <h4 class="font-semibold text-slate-200 mb-2 flex items-center gap-2"><i class="fas fa-video text-teal-400"></i>Panduan Veo</h4>
                        <ul class="list-disc list-inside text-slate-400 text-sm space-y-1">
                            <li>Buka <a href="https://gemini.google.com/" target="_blank" class="text-teal-300 hover:underline font-semibold">Gemini</a> (sebelumnya Bard).</li>
                            <li>Pastikan Anda memiliki akses ke model Veo (mungkin memerlukan langganan Gemini Advanced).</li>
                            <li>Salin prompt Bahasa Inggris dari hasil di bawah.</li>
                            <li>Tempel (paste) prompt tersebut ke dalam kolom chat Gemini.</li>
                            <li>Kirim prompt dan tunggu Gemini menghasilkan video Anda.</li>
                        </ul>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Indonesian Prompt -->
                        <div>
                            <h3 class="text-lg font-semibold mb-2 text-slate-300">Prompt Bahasa Indonesia</h3>
                            <div class="relative">
                                <textarea id="outputPrompt-id" rows="10" class="form-textarea font-mono text-sm"></textarea>
                                <button id="translate-btn" class="absolute top-3 right-3 btn-secondary-theme font-semibold py-2 px-3 rounded-lg text-sm flex items-center justify-center" title="Simpan & Terjemahkan">
                                    <i class="fas fa-language"></i>
                                </button>
                            </div>
                        </div>
                        <!-- English Prompt -->
                        <div>
                            <h3 class="text-lg font-semibold mb-2 text-slate-300">Prompt Bahasa Inggris (Final)</h3>
                            <div class="relative">
                                <textarea id="outputPrompt-en" rows="10" class="form-textarea font-mono text-sm" readonly></textarea>
                                <button id="copy-en-btn" class="absolute top-3 right-3 btn-secondary-theme font-semibold py-2 px-3 rounded-lg text-sm flex items-center justify-center" title="Salin Prompt Inggris">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </fieldset>
        </main>
    </div>
    
    <!-- Custom Alert Container -->
    <div id="alert-placeholder" class="fixed top-5 right-5 z-[110] w-full max-w-sm space-y-3"></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Security: Dev Tools Check & Right-Click ---
        const devToolCheck = () => {
            const threshold = 160;
            if (window.outerWidth - window.innerWidth > threshold || window.outerHeight - window.innerHeight > threshold) {
                document.body.innerHTML = '<div style="position:fixed;top:0;left:0;width:100%;height:100%;background:#0f172a;color:white;display:flex;justify-content:center;align-items:center;font-family:sans-serif;font-size:2rem;">Akses tidak diizinkan.</div>';
                setTimeout(() => { window.location.href = "about:blank"; }, 1000);
            }
        };
        setInterval(devToolCheck, 1000);

        document.addEventListener('contextmenu', (event) => {
            const target = event.target;
            if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA') {
                return; 
            }
            event.preventDefault();
        });

        // --- DOM ELEMENTS ---
        const generatorFieldset = document.getElementById('generator-fieldset');
        const authSection = document.getElementById('auth-section');
        const loginForm = document.getElementById('login-form');
        const logoutArea = document.getElementById('logout-area');
        const passwordInput = document.getElementById('password-input');
        const togglePasswordBtn = document.getElementById('toggle-password-btn');
        const passwordEyeIcon = document.getElementById('password-eye-icon');
        const loginBtn = document.getElementById('login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const logoutConfirmModal = document.getElementById('logout-confirm-modal');
        const confirmLogoutBtn = document.getElementById('confirm-logout-btn');
        const cancelLogoutBtn = document.getElementById('cancel-logout-btn');

        const detailedForm = document.getElementById('detailed-form');
        const aiButton = document.getElementById('ai-generate-btn');
        const outputPromptIdEl = document.getElementById('outputPrompt-id');
        const outputPromptEnEl = document.getElementById('outputPrompt-en');
        const translateBtn = document.getElementById('translate-btn');
        const copyEnBtn = document.getElementById('copy-en-btn');
        const resultSection = document.getElementById('result-section');
        
        // Modal elements
        const guideModal = document.getElementById('guide-modal');
        const guideBtn = document.getElementById('guide-btn');
        const deleteConfirmModal = document.getElementById('delete-confirm-modal');
        const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
        const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
        const historyBtn = document.getElementById('history-btn');
        const historyModal = document.getElementById('history-modal');
        const historyList = document.getElementById('history-list');
        const clearHistoryBtn = document.getElementById('clear-history-btn');
        
        const apiKeyInput = document.getElementById('api-key-input');
        const saveApiKeyButton = document.getElementById('save-api-key-button');
        const deleteApiKeyButton = document.getElementById('delete-api-key-button');
        const apiStatusDot = document.getElementById('api-status-dot');
        const apiStatusText = document.getElementById('api-status-text');

        // Theme toggle
        const themeToggleBtn = document.getElementById('theme-toggle');
        const body = document.body;

        // --- SELECT OPTIONS ---
        const cameraAngleOptions = { "":"-- Pilih Sudut --", "eye-level shot":"Eye-level", "low-angle shot":"Low-angle", "high-angle shot":"High-angle", "dutch angle":"Dutch angle", "bird's-eye view":"Bird's-eye view", "worm's-eye view": "Worm's-eye view" };
        const cameraShotOptions = { "":"-- Pilih Bidikan --", "extreme close-up":"Extreme Close-up", "close-up":"Close-up", "medium shot":"Medium shot", "long shot":"Long shot", "wide shot":"Wide shot", "establishing shot": "Establishing shot" };
        const cameraMovementOptions = { "":"-- Pilih Gerakan --", "static shot":"Static", "panning shot":"Panning", "tilting shot":"Tilting", "dolly zoom":"Dolly zoom", "tracking shot":"Tracking", "handheld":"Handheld", "drone footage":"Drone footage" };
        const styleOptions = { "":"-- Pilih Gaya --", "Realistic": "Realistic", "Cinematic": "Cinematic", "Anime": "Anime", "3D Animation": "3D Animation", "Pixar Style": "Pixar Style", "Claymation": "Claymation", "Stop Motion": "Stop Motion", "Documentary": "Documentary", "Vintage Film": "Vintage Film", "Noir Film": "Noir Film", "Cyberpunk": "Cyberpunk", "Steampunk": "Steampunk", "Fantasy Art": "Fantasy Art", "Watercolor": "Watercolor", "Pixel Art": "Pixel Art" };
        const lightingOptions = { "":"-- Pilih Pencahayaan --", "Golden Hour": "Golden Hour", "Blue Hour": "Blue Hour", "Volumetric Lighting": "Volumetric Lighting", "Dramatic Lighting": "Dramatic Lighting", "Cinematic Lighting": "Cinematic Lighting", "Studio Lighting": "Studio Lighting", "Neon Lighting": "Neon Lighting", "Soft Lighting": "Soft Lighting", "Backlight": "Backlight", "Rim Lighting": "Rim Lighting", "High-Key Lighting": "High-Key Lighting", "Low-Key Lighting": "Low-Key Lighting" };

        // --- FUNCTIONS ---
        const populateSelect = (selectId, options) => {
            const select = document.getElementById(selectId);
            select.innerHTML = '';
            for (const [value, text] of Object.entries(options)) {
                const option = document.createElement('option');
                option.value = value;
                option.textContent = text;
                select.appendChild(option);
            }
        };
        
        const closeAlert = (alertEl) => {
            if (!alertEl || !document.body.contains(alertEl)) return;
            clearTimeout(alertEl.autoCloseTimer);
            alertEl.classList.add('opacity-0');
            alertEl.querySelector('.custom-alert-box').classList.add('scale-95');
            setTimeout(() => alertEl.remove(), 300);
        };

        const showAlert = (type, title, message, details = '') => {
            const alertEl = document.createElement('div');
            alertEl.className = `custom-alert-overlay flex transition-opacity duration-300 opacity-0`;
            let detailHtml = details ? `<pre class="mt-2 text-xs text-left bg-black/20 p-2 rounded-md whitespace-pre-wrap">${details}</pre>` : '';
            alertEl.innerHTML = `
                <div class="custom-alert-box rounded-xl border border-slate-700 transform transition-transform duration-300 scale-95">
                    <div class="custom-alert-icon ${type}">${type === 'success' ? '<i class="fas fa-check"></i>' : '<i class="fas fa-times"></i>'}</div>
                    <h4 class="font-bold text-lg mb-1 text-slate-100">${title}</h4>
                    <p class="text-sm text-slate-300">${message}</p>
                    ${detailHtml}
                </div>
            `;
            
            alertEl.addEventListener('click', (e) => {
                if (e.target === alertEl) {
                    closeAlert(alertEl);
                }
            });

            document.body.appendChild(alertEl);
            
            setTimeout(() => {
                alertEl.classList.remove('opacity-0');
                alertEl.querySelector('.custom-alert-box').classList.remove('scale-95');
            }, 10);

            alertEl.autoCloseTimer = setTimeout(() => {
                closeAlert(alertEl);
            }, 6000);
        };

        const populateForm = (data) => {
            document.getElementById('subject').value = data.subject || '';
            document.getElementById('action').value = data.action || '';
            document.getElementById('setting').value = data.setting || '';
            // document.getElementById('style').value = data.style || ''; // Removed as style is now user-defined
            document.getElementById('lighting').value = data.lighting || '';
            document.getElementById('extra-details').value = data.extraDetails || '';
            document.getElementById('negative-prompt').value = data.negativePrompt || '';
            document.getElementById('sound-effects').value = data.soundEffects || '';
            document.getElementById('character-speech').value = data.characterSpeech || '';
            document.getElementById('camera-angle').value = data.cameraAngle || '';
            document.getElementById('camera-shot').value = data.cameraShot || '';
            document.getElementById('camera-movement').value = data.cameraMovement || '';
            detailedForm.classList.remove('hidden');
            detailedForm.scrollIntoView({ behavior: 'smooth' });
        };

        // --- API Key Management ---
        const openModal = (modal) => modal.classList.remove('hidden');
        const closeModal = (modal) => modal.classList.add('hidden');

        const updateApiStatus = (status, message) => {
            apiStatusDot.className = 'w-3 h-3 rounded-full'; // Reset
            apiStatusText.className = 'text-sm';
            switch(status) {
                case 'active':
                    apiStatusDot.classList.add('bg-green-500');
                    apiStatusText.classList.add('text-green-400');
                    break;
                case 'inactive':
                    apiStatusDot.classList.add('bg-rose-500');
                    apiStatusText.classList.add('text-rose-400');
                    break;
                default: // checking or unknown
                    apiStatusDot.classList.add('bg-slate-500');
                    apiStatusText.classList.add('text-slate-400');
            }
            apiStatusText.textContent = `Status: ${message}`;
        };

        const checkApiKey = async (key) => {
            if (!key) {
                updateApiStatus('inactive', 'Tidak ada API Key');
                return false;
            }
            updateApiStatus('checking', 'Memvalidasi...');
            const validationUrl = `https://generativelanguage.googleapis.com/v1beta/models?key=${key}`;
            try {
                const response = await fetch(validationUrl);
                if (response.ok) {
                    updateApiStatus('active', 'Aktif dan Valid');
                    return true;
                } else {
                    updateApiStatus('inactive', 'API Key Tidak Valid');
                    return false;
                }
            } catch (error) {
                updateApiStatus('inactive', 'Gagal memvalidasi');
                return false;
            }
        };
        
        saveApiKeyButton.addEventListener('click', async () => {
            const key = apiKeyInput.value.trim();
            if (!key) {
                showAlert('error', 'Input Kosong', 'Harap masukkan API Key.');
                return;
            }
            const isValid = await checkApiKey(key);
            if (isValid) {
                localStorage.setItem('geminiApiKey', key);
                showAlert('success', 'Berhasil', 'API Key berhasil disimpan dan divalidasi!');
            } else {
                showAlert('error', 'Gagal', 'API Key yang Anda masukkan tidak valid.');
            }
        });

        deleteApiKeyButton.addEventListener('click', () => {
            if (localStorage.getItem('geminiApiKey')) {
                openModal(deleteConfirmModal);
            } else {
                showAlert('error', 'Tidak Ada Kunci', 'Tidak ada API Key yang bisa dihapus.');
            }
        });
        
        confirmDeleteBtn.addEventListener('click', () => {
            localStorage.removeItem('geminiApiKey');
            apiKeyInput.value = '';
            updateApiStatus('inactive', 'Tidak ada API Key');
            showAlert('success', 'Berhasil', 'API Key berhasil dihapus.');
            closeModal(deleteConfirmModal);
        });

        cancelDeleteBtn.addEventListener('click', () => closeModal(deleteConfirmModal));
        deleteConfirmModal.addEventListener('click', (e) => {
             if (e.target === deleteConfirmModal) closeModal(deleteConfirmModal);
        });

        // --- Main Gemini Call ---
        const generateWithGemini = async (story, visualStyle) => {
            const apiKey = localStorage.getItem('geminiApiKey');
            if (!apiKey) {
                showAlert("error", "API Key Diperlukan", "Harap masukkan dan simpan API Key Anda terlebih dahulu.");
                return;
            }

            const aiBtnText = document.getElementById('ai-btn-text');
            const spinner = aiButton.querySelector('.loading-spinner');
            aiBtnText.textContent = 'Memproses...';
            spinner.classList.remove('hidden');
            aiButton.disabled = true;

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
            const prompt = `Anda adalah seorang sutradara film dan ahli prompt engineering untuk AI video seperti Google Veo. Tugas Anda adalah mengambil ide cerita dan gaya visual dari pengguna, lalu mengembangkannya menjadi komponen prompt yang kaya, detail, dan sinematik.

PENTING: Karena ini adalah untuk video, adegan yang Anda hasilkan HARUS memiliki pergerakan. Deskripsikan gerakan karakter, lingkungan, atau kamera. Jangan membuat gambar statis.

Ide Cerita Pengguna: "${story}"
Gaya Visual Pilihan: "${visualStyle}"

Berdasarkan informasi di atas, isi semua kolom dalam skema JSON berikut secara kreatif. Pikirkan seperti sutradara: pencahayaan dan pergerakan kamera apa yang paling cocok? Detail spesifik apa yang akan membuat adegan ini tak terlupakan?

- **subject**: Deskripsikan karakter/subjek utama.
- **action**: Rincikan aksi sinematik spesifik yang mereka lakukan, pastikan ada gerakan.
- **setting**: Gambarkan lingkungan dengan detail yang kaya.
- **lighting**: Jelaskan pencahayaan dengan istilah sinematik.
- **extraDetails**: Tambahkan efek atau elemen nyata yang spesifik.
- **soundEffects**: Deskripsikan suara latar/musik yang sesuai.
- **characterSpeech**: Dialog atau ucapan singkat. Jika tidak ada, biarkan kosong.
- **negativePrompt**: Sarankan istilah untuk dihindari.
- **cameraAngle**: Pilih sudut kamera yang paling pas.
- **cameraShot**: Pilih jenis bidikan.
- **cameraMovement**: Sarankan gerakan kamera yang dinamis.

Output HANYA berupa objek JSON yang valid, tanpa teks tambahan. Semua nilai string harus dalam Bahasa Indonesia. Anda TIDAK perlu lagi menentukan "style" karena sudah diberikan.`;

            const payload = {
                contents: [{ role: "user", parts: [{ text: prompt }] }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "subject": { "type": "STRING" }, 
                            "action": { "type": "STRING" }, 
                            "setting": { "type": "STRING" },
                            "lighting": { "type": "STRING", "enum": Object.keys(lightingOptions).filter(k => k) }, 
                            "extraDetails": { "type": "STRING" },
                            "soundEffects": { "type": "STRING" }, 
                            "characterSpeech": { "type": "STRING" },
                            "negativePrompt": { "type": "STRING" },
                            "cameraAngle": { "type": "STRING", "enum": Object.keys(cameraAngleOptions).filter(k => k) },
                            "cameraShot": { "type": "STRING", "enum": Object.keys(cameraShotOptions).filter(k => k) },
                            "cameraMovement": { "type": "STRING", "enum": Object.keys(cameraMovementOptions).filter(k => k) }
                        },
                        required: ["subject", "action", "setting", "lighting", "extraDetails", "cameraAngle", "cameraShot", "cameraMovement", "negativePrompt", "soundEffects", "characterSpeech"]
                    }
                }
            };

            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: { message: 'Gagal membaca respons error dari server.' } }));
                    const errorMessage = errorData.error?.message || `API Error: ${response.status}`;
                    throw new Error(errorMessage);
                }
                const result = await response.json();
                if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts) {
                    const parsedJson = JSON.parse(result.candidates[0].content.parts[0].text);
                    populateForm(parsedJson);
                    showAlert('success', 'Analisis Selesai', 'AI telah mengisi detail video untuk Anda.');
                    saveStoryToHistory(story);
                } else { throw new Error("Struktur respons API tidak valid."); }
            } catch (error) {
                showAlert('error', 'Gagal Terhubung', 'Gagal menghubungi AI. Pesan dari server:', error.message);
            } finally {
                aiBtnText.innerHTML = `<i class="fas fa-lightbulb mr-3"></i>Kembangkan Ide dengan AI`;
                spinner.classList.add('hidden');
                aiButton.disabled = false;
            }
        };
        
        const translatePrompt = async (textToTranslate) => {
            const apiKey = localStorage.getItem('geminiApiKey');
            if (!apiKey) {
                showAlert("error", "API Key Diperlukan", "Harap masukkan dan simpan API Key Anda untuk menerjemahkan.");
                return;
            }
            
            const originalIcon = translateBtn.innerHTML;
            translateBtn.innerHTML = `<div class="loading-spinner h-4 w-4"></div>`;
            translateBtn.disabled = true;

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
            const prompt = `Translate the following Indonesian text to English. The text is a prompt for a text-to-video AI, so maintain the descriptive and cinematic tone. IMPORTANT EXCEPTION: Find the part of the text that starts with "saying:". Do NOT translate the text inside the quotes that follows it. Keep the quoted dialogue in its original Indonesian language. For example, if the input is 'saying: "Aku di sini"', the output should be 'saying: "Aku di sini"'. Text: "${textToTranslate}"`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };

            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ error: { message: 'Gagal membaca respons error dari server.' } }));
                    throw new Error(errorData.error?.message || `API Error: ${response.status}`);
                }
                const result = await response.json();
                if (result.candidates && result.candidates[0].content && result.candidates[0].content.parts) {
                    outputPromptEnEl.value = result.candidates[0].content.parts[0].text;
                    showAlert('success', 'Berhasil', 'Prompt telah diterjemahkan ke Bahasa Inggris.');
                } else { throw new Error("Struktur respons terjemahan tidak valid."); }
            } catch (error) {
                showAlert('error', 'Gagal Menerjemahkan', error.message);
            } finally {
                translateBtn.innerHTML = originalIcon;
                translateBtn.disabled = false;
            }
        };


        // --- EVENT LISTENERS ---
        guideBtn.addEventListener('click', () => openModal(guideModal));
        guideModal.addEventListener('click', (e) => {
            if (e.target === guideModal || e.target.closest('.close-modal-btn')) {
                closeModal(guideModal);
            }
        });
        
        historyBtn.addEventListener('click', () => {
            renderHistory();
            openModal(historyModal);
        });
        historyModal.addEventListener('click', (e) => {
            if (e.target === historyModal || e.target.closest('.close-modal-btn')) {
                closeModal(historyModal);
            }
        });

        aiButton.addEventListener('click', () => {
            const story = document.getElementById('video-story').value.trim();
            const visualStyle = document.getElementById('style').value;
            if (!story) {
                showAlert("error", "Cerita Dibutuhkan", "Harap isi kolom cerita sebelum menggunakan AI.");
                return;
            }
            if (!visualStyle) {
                showAlert("error", "Gaya Visual Dibutuhkan", "Harap pilih gaya visual sebelum menggunakan AI.");
                return;
            }
            generateWithGemini(story, visualStyle);
        });

        detailedForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            const fields = ['subject', 'action', 'setting', 'lighting', 'camera-angle', 'camera-shot', 'camera-movement', 'extra-details', 'sound-effects', 'character-speech', 'negative-prompt'];
            const values = fields.map(id => document.getElementById(id).value.trim());
            const styleValue = document.getElementById('style').value; // Get style from Step 1
            
            let promptParts = [];
            let scene = [values[0], values[1], values[2] ? `dengan latar ${values[2]}` : ''].filter(Boolean);
            if (scene.length > 0) promptParts.push(scene.join(' '));
            
            if (styleValue && styleOptions[styleValue]) promptParts.push(`gaya visual: ${styleOptions[styleValue]}`);
            if (values[3] && lightingOptions[values[3]]) promptParts.push(`pencahayaan: ${lightingOptions[values[3]]}`);
            if (values[4] && cameraAngleOptions[values[4]]) promptParts.push(`sudut kamera: ${cameraAngleOptions[values[4]]}`);
            if (values[5] && cameraShotOptions[values[5]]) promptParts.push(`jenis bidikan: ${cameraShotOptions[values[5]]}`);
            if (values[6] && cameraMovementOptions[values[6]]) promptParts.push(`gerakan kamera: ${cameraMovementOptions[values[6]]}`);
            if (values[7]) promptParts.push(`detail tambahan: ${values[7]}`);
            if (values[8]) promptParts.push(`efek suara: ${values[8]}`);
            if (values[9]) promptParts.push(`saying: "${values[9]}"`);

            let finalIndonesianPrompt = promptParts.join(', ');

            if (values[10]) { // Index is now 10 for negative prompt
                finalIndonesianPrompt += ` --no ${values[10]}`;
            }
            
            outputPromptIdEl.value = finalIndonesianPrompt;
            resultSection.classList.remove('hidden');
            resultSection.scrollIntoView({ behavior: 'smooth' });
            
            // Automatically translate after generating
            await translatePrompt(finalIndonesianPrompt);
        });

        detailedForm.addEventListener('reset', () => {
            detailedForm.reset();
            // Note: The style dropdown in Step 1 is not part of this form, so it won't be reset, which is intended.
            resultSection.classList.add('hidden');
            showAlert('success', 'Form Direset', 'Semua isian pada form ini telah dikosongkan.');
        });

        translateBtn.addEventListener('click', () => {
            const indonesianPrompt = outputPromptIdEl.value.trim();
            if (!indonesianPrompt) {
                showAlert('error', 'Prompt Kosong', 'Tidak ada teks untuk diterjemahkan.');
                return;
            }
            translatePrompt(indonesianPrompt);
        });

        const copyToClipboard = (text, buttonId) => {
            if (!text) {
                showAlert('error', 'Prompt Kosong', 'Tidak ada teks untuk disalin.');
                return;
            }
            
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed";
            textArea.style.top = "-9999px";
            textArea.style.left = "-9999px";
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();

            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showAlert('success', 'Berhasil Disalin', 'Prompt telah disalin ke clipboard.');
                    const btn = document.getElementById(buttonId);
                    const icon = btn.querySelector('i');
                    const originalIconClass = icon.className;
                    icon.className = 'fas fa-check';
                    setTimeout(() => { icon.className = originalIconClass; }, 2000);
                } else {
                     showAlert('error', 'Gagal Menyalin', 'Browser Anda mungkin tidak mendukung fitur ini.');
                }
            } catch (err) {
                 showAlert('error', 'Gagal Menyalin', 'Terjadi kesalahan teknis.');
            }
            document.body.removeChild(textArea);
        };
        
        copyEnBtn.addEventListener('click', () => copyToClipboard(outputPromptEnEl.value, 'copy-en-btn'));

        // --- Theme Toggle Logic ---
        const applyTheme = (theme) => {
            body.className = theme === 'light' ? 'light-theme' : 'dark-theme';
            themeToggleBtn.innerHTML = theme === 'light' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
            localStorage.setItem('theme', theme);
        };
        themeToggleBtn.addEventListener('click', () => {
            const newTheme = body.classList.contains('light-theme') ? 'dark' : 'light';
            applyTheme(newTheme);
        });

        // --- Auth Logic ---
        const grantAccess = () => {
            loginForm.classList.add('hidden');
            logoutArea.classList.remove('hidden');
            generatorFieldset.disabled = false;
        };

        const lockAccess = () => {
            logoutArea.classList.add('hidden');
            loginForm.classList.remove('hidden');
            generatorFieldset.disabled = true;
            sessionStorage.removeItem('isLoggedIn');
        };

        loginBtn.addEventListener('click', () => {
            if (passwordInput.value === '123') {
                sessionStorage.setItem('isLoggedIn', 'true');
                grantAccess();
                showAlert('success', 'Berhasil Masuk', 'Selamat datang! Aplikasi siap digunakan.');
            } else {
                showAlert('error', 'Gagal Masuk', 'Kata sandi yang Anda masukkan salah.');
            }
        });
        
        passwordInput.addEventListener('keyup', (e) => {
            if (e.key === 'Enter') loginBtn.click();
        });

        togglePasswordBtn.addEventListener('click', () => {
            const isPassword = passwordInput.type === 'password';
            passwordInput.type = isPassword ? 'text' : 'password';
            passwordEyeIcon.className = isPassword ? 'fas fa-eye-slash' : 'fas fa-eye';
        });

        logoutBtn.addEventListener('click', () => openModal(logoutConfirmModal));
        confirmLogoutBtn.addEventListener('click', () => {
            lockAccess();
            closeModal(logoutConfirmModal);
            showAlert('success', 'Berhasil Keluar', 'Aplikasi telah dikunci kembali.');
        });
        cancelLogoutBtn.addEventListener('click', () => closeModal(logoutConfirmModal));
        logoutConfirmModal.addEventListener('click', (e) => {
            if (e.target === logoutConfirmModal) closeModal(logoutConfirmModal);
        });
        
        // --- History Logic ---
        const getHistory = () => JSON.parse(localStorage.getItem('veoStoryHistory') || '[]');
        const saveStoryToHistory = (story) => {
            let history = getHistory();
            if (!history.includes(story)) {
                history.unshift(story);
                history = history.slice(0, 20); // Keep last 20
                localStorage.setItem('veoStoryHistory', JSON.stringify(history));
            }
        };

        const renderHistory = () => {
            const history = getHistory();
            historyList.innerHTML = '';
            if (history.length === 0) {
                historyList.innerHTML = '<p class="text-center text-slate-500">Riwayat cerita Anda masih kosong.</p>';
                return;
            }
            history.forEach((story, index) => {
                const item = document.createElement('div');
                item.className = 'p-3 rounded-lg flex justify-between items-center bg-slate-800/50';
                item.innerHTML = `
                    <p class="text-sm text-slate-300 truncate mr-4">${story}</p>
                    <div class="flex-shrink-0 flex gap-2">
                        <button class="load-history-btn btn-secondary-theme p-2 rounded-md leading-none" data-index="${index}" title="Muat Cerita"><i class="fas fa-upload"></i></button>
                        <button class="delete-history-btn bg-red-600/80 hover:bg-red-600 p-2 rounded-md leading-none" data-index="${index}" title="Hapus"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                historyList.appendChild(item);
            });
        };

        historyList.addEventListener('click', (e) => {
            const button = e.target.closest('button');
            if (!button) return;

            const index = button.dataset.index;
            let history = getHistory();

            if (button.classList.contains('load-history-btn')) {
                document.getElementById('video-story').value = history[index];
                showAlert('success', 'Berhasil', 'Cerita dari riwayat telah dimuat.');
                closeModal(historyModal);
            } else if (button.classList.contains('delete-history-btn')) {
                history.splice(index, 1);
                localStorage.setItem('veoStoryHistory', JSON.stringify(history));
                renderHistory();
            }
        });
        
        clearHistoryBtn.addEventListener('click', () => {
            if(confirm('Apakah Anda yakin ingin menghapus semua riwayat cerita?')) {
                localStorage.removeItem('veoStoryHistory');
                renderHistory();
                showAlert('success', 'Berhasil', 'Semua riwayat telah dihapus.');
            }
        });


        // --- Initial Load ---
        populateSelect('camera-angle', cameraAngleOptions);
        populateSelect('camera-shot', cameraShotOptions);
        populateSelect('camera-movement', cameraMovementOptions);
        populateSelect('style', styleOptions);
        populateSelect('lighting', lightingOptions);
        
        if (sessionStorage.getItem('isLoggedIn') === 'true') {
            grantAccess();
        } else {
            lockAccess();
        }
        
        const savedKey = localStorage.getItem('geminiApiKey');
        if (savedKey) {
            apiKeyInput.value = savedKey;
            checkApiKey(savedKey);
        } else {
            updateApiStatus('inactive', 'Tidak ada API Key');
        }
        
        const savedTheme = localStorage.getItem('theme') || 'dark';
        applyTheme(savedTheme);
    });
    </script>
</body>
</html>

